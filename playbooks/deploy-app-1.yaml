- hosts: localhost
  connection: local
  vars:
    target_clusters:
      - sno-worker-01
      - sno-worker-02
      - 5g-deployment-lab
    kubeconfig_output_path: "/tmp/kubeconfig-extracted.yaml" # Ruta donde se guardar√° el kubeconfig
    deploy_emoji: False
  tasks:
      - name: Process every result and extract the kubeconfig # This task's name for the include
        ansible.builtin.include_tasks: process_kubeconfig.yaml # Reference the new file
        loop: "{{ ansible_eda.event.body }}"
        when:
          - item.eventAnnotations['cgu.openshift.io/event-type'] == "global"
          - item.cguName in target_clusters
          - item.reason == "CguSuccess"
